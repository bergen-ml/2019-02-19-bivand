---
title: "Applied spatial data analysis with R: status and prospects"
author: "Roger Bivand"
date: "19 February 2019"
output: 
  beamer_presentation:
    theme: metropolis
    pandoc_args: [
      '--pdf-engine=xelatex'
    ]
    highlight: pygments
    includes:
      in_header: header.tex
    keep_tex: true
classoption: "aspectratio=169"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r size, echo=FALSE, results='hide'}
knitr::knit_hooks$set(mysize = function(before, options, envir) {
  if (before) 
    return(options$size)
})
knitr::opts_chunk$set(prompt=TRUE)
suppressMessages(library(extrafont))
suppressMessages(loadfonts())
```

```{r set-options, echo=FALSE, results='hide'}
options(width = 50)
```

# Introduction

## Outline

- Spatial and spatio-temporal data are characterised by structures that distinguish them from typical tabular data

- The geometric structures also have spatial reference system information, and can adhere to standards, which may ease geometrical operations

- Satellite data and numerical model output data typically have regular grid structures, but these are often domain-specific

- Computationally intensive tasks include interpolation, upsampling, focal operations, change of support and handling vector data with very detailed boundaries, as well as modelling using Bayesian inference

- A further challenge to modelling using training sets with spatial data is how to split the observations in the presence of spatial dependence

# Spatial and spatio-temporal data

## Spatial data

\begincols
\begincol{0.48\textwidth}

Spatial data typically combine position data in 2D (or 3D), attribute data and metadata related to the position data. Much spatial data could be called map data or GIS data. We collect and handle much more position data since global navigation satellite system (GNSS) like GPS came on stream 20 years ago, earth observation satellites have been providing data for longer. 

\endcol
\begincol{0.48\textwidth}

```{r, echo = TRUE, mysize=TRUE, size='\\tiny'}
library(osmdata)
library(sf)
bbox <- opq(bbox = 'bergen norway')
byb0 <- osmdata_sf(add_osm_feature(bbox, key = 'railway',
  value = 'light_rail'))$osm_lines
tram <- osmdata_sf(add_osm_feature(bbox, key = 'railway',
  value = 'tram'))$osm_lines
byb1 <- tram[!is.na(tram$name),]
o <- intersect(names(byb0), names(byb1))
byb <- rbind(byb0[,o], byb1[,o])
```
```{r, echo = TRUE, eval=FALSE, mysize=TRUE, size='\\tiny'}
library(mapview)
mapview(byb)
```


```{r plot1, mysize=TRUE, size='\\tiny', fig.show='hide', fig.height=4, fig.width=8, dev.args=list(family="Fira Sans")}
## library(mapview)
## mapview(byb)
## \includegraphics[width=0.95\textwidth]{bml_bivand_feb19_files/figure-beamer/plot1-1.pdf}
```

\endcol
\endcols

## Vector data

\begincols
\begincol{0.48\textwidth}

Spatial vector data is based on points, from which other geometries are constructed. The light rail tracks are 2D vector data. The points themselves are stored as double precision floating point numbers, typically without recorded measures of accuracy (GNSS provides a measure of accuracy). Here, lines are constructed from points.

\endcol
\begincol{0.48\textwidth}

```{r, echo = TRUE, mysize=TRUE, size='\\tiny'}
all(st_is(byb, "XY"))
str(st_coordinates(st_geometry(byb)[[1]]))
```

\endcol
\endcols

## Raster data

\begincols
\begincol{0.48\textwidth}

Spatial raster data is observed using rectangular (often square) cells, within which attribute data are observed. We probably do not know where within the raster cell the observed value is correct; all we know is that at the chosen resolution, this is the value representing the whole cell area.

\endcol

\begincol{0.48\textwidth}

```{r, echo = TRUE, mysize=TRUE, cache=TRUE, size='\\tiny'}
library(elevatr)
elevation <- get_elev_raster(as(byb, "Spatial"), z = 14)
```

```{r, echo = TRUE, eval=FALSE, mysize=TRUE, size='\\tiny'}
mapview(elevation, col=terrain.colors)
```

\endcol
\endcols


## Spatio-temporal data

\begincols
\begincol{0.48\textwidth}
https://landgis.opengeohub.org/#/?base=Stamen%20(OpenStreetMap)&center=60.4478,5.3352&zoom=11&opacity=80&layer=lcv_land.cover_esacci.lc.l4_c&time=2015
\endcol

\begincol{0.48\textwidth}

\endcol
\endcols


## Representing spatial vector data in R (**sp**)

\begincols
\begincol{0.48\textwidth}

\endcol

\begincol{0.48\textwidth}

```{r, echo = TRUE, mysize=TRUE, size='\\tiny'}
library(sp)
str(slot(as(st_geometry(byb), "Spatial"), "lines")[[1]])
```


\endcol
\endcols

## Representing spatial vector data in R (**sf**)


\begincols
\begincol{0.48\textwidth}



\endcol

\begincol{0.48\textwidth}


```{r, echo = TRUE, mysize=TRUE, size='\\tiny'}
strwrap(st_as_text(st_geometry(byb)[[1]]))
```

\endcol
\endcols

## Representing spatial raster data in R (**sp** and **raster**)

\begincols
\begincol{0.48\textwidth}

\endcol

\begincol{0.48\textwidth}

```{r, echo = TRUE, mysize=TRUE, cache=TRUE, size='\\tiny'}
elevation
slot(as(elevation, "SpatialGrid"), "grid")
```


\endcol
\endcols

## Representing spatial raster data in R (**sf** and **stars**)

\begincols
\begincol{0.48\textwidth}

\endcol

\begincol{0.48\textwidth}

\endcol
\endcols


# Spatial reference systems

## Baseline WKT and PROJ4

\begincols
\begincol{0.48\textwidth}

\endcol

\begincol{0.48\textwidth}

\endcol
\endcols


## Escaping the WGS84 hub: PROJ4 6.0 and WKT2

\begincols
\begincol{0.48\textwidth}

\endcol

\begincol{0.48\textwidth}

\endcol
\endcols



# Earth observation

## Volume and frequency

\begincols
\begincol{0.48\textwidth}

\endcol

\begincol{0.48\textwidth}

\endcol
\endcols


## Array storage

\begincols
\begincol{0.48\textwidth}

\endcol

\begincol{0.48\textwidth}

\endcol
\endcols


## Cloud storage

\begincols
\begincol{0.48\textwidth}

\endcol

\begincol{0.48\textwidth}

\endcol
\endcols



# Computationally intensive tasks

## Data handling

\begincols
\begincol{0.48\textwidth}

\endcol

\begincol{0.48\textwidth}

\endcol
\endcols


## Interpolation

\begincols
\begincol{0.48\textwidth}

\endcol

\begincol{0.48\textwidth}

\endcol
\endcols


## Inference

## Inference under heterogeneity

\begincols
\begincol{0.48\textwidth}

\endcol

\begincol{0.48\textwidth}

\endcol
\endcols


## Inference under dependence

\begincols
\begincol{0.48\textwidth}

\endcol

\begincol{0.48\textwidth}

\endcol
\endcols



# Spatial dependence and subsetting data

## Heterogeneity and dependence


\begincols
\begincol{0.48\textwidth}

\endcol

\begincol{0.48\textwidth}

\endcol
\endcols


# Conclusions

## Conclusions

\begincols
\begincol{0.48\textwidth}

\endcol

\begincol{0.48\textwidth}

\endcol
\endcols



[comment]: \nobibliography{bml19}
